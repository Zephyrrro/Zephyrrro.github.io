---
title: DOM Render
date: 2020-05-09 20:30:01
index_img: /img/dom-render/render-tree-construction.png
tags: [DOM, brower]
excerpt: æµè§ˆå™¨çš„æ¸²æŸ“è¿‡ç¨‹
---

{% note  secondary %}

ä¸€é“è€ç”Ÿå¸¸è°ˆçš„é—®é¢˜ï¼šä»è¾“å…¥URLåˆ°é¡µé¢å±•ç¤ºï¼Œç»å†äº†å“ªäº›è¿‡ç¨‹......

è¿™é‡Œå¹¶ä¸å…¨éƒ¨è®¨è®ºï¼Œæ¥å…³æ³¨ä¸€ä¸‹æœ€åä¸€ä¸ªè¿‡ç¨‹ï¼šæµè§ˆå™¨çš„æ¸²æŸ“è¿‡ç¨‹ã€‚

{% endnote %}

æ ¹æ® [Google Web](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction) ï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹äº”ä¸ªé˜¶æ®µï¼š

- æ ¹æ® `HTML` ç”Ÿæˆ `DOM Tree` (æ­¤æ—¶å¹¶ä¸æ¸²æŸ“åˆ°é¡µé¢ä¸Š)
- æ ¹æ® `CSS` ç”Ÿæˆå¯¹åº”çš„ `CSSOM Tree` (ä¸ `DOM Tree`ä¸Šçš„ç»“ç‚¹ä¸€ä¸€å¯¹åº”)
- `DOM Tree` å’Œ `CSSOM Tree` åˆæˆç”Ÿæˆ `Render Tree` (ä¸åŒ…æ‹¬ `head`, `meta` ç­‰ä¸å¯è§çš„ç»“ç‚¹)
- `Layout` å¸ƒå±€æ¸²æŸ“
- `Paint` ç»˜åˆ¶æ¸²æŸ“

------

## DOM Tree

`DOM`ï¼Œå…¨ç§° `Document Object Model`ï¼Œæ˜¯ä¸€ç§å¯¹è±¡æ¨¡å‹ï¼Œè½¬åŒ–æˆæ ‘çš„è¿‡ç¨‹ä¸ºï¼š`Bytes â†’ Characters â†’ Tokens â†’ Nodes â†’ DOM`.(å…·ä½“å¯ä»¥è·³ğŸ‘‰[constructing-the-object-model](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/constructing-the-object-model) )

## CSSOM Tree

åŒæ ·ä¹Ÿæ˜¯æ ‘çš„ç»“æ„ï¼ŒåŒæ—¶ç”Ÿæˆçš„è¿‡ç¨‹ä¹Ÿæ˜¯å¯¹æµè§ˆå™¨é»˜è®¤æ ·å¼çš„é€æ­¥æ›¿æ¢ã€‚

## Render Tree

`DOM Tree` å’Œ `CSSOM Tree` åˆå¹¶ç”Ÿæˆ `Render Tree` (æ¸²æŸ“æ ‘)

![](/img/dom-render/render-tree-construction.png)

`DOM Tree` ä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†æ¯ä¸ªå¯è§ç»“ç‚¹(DFS/BFS?)å¹¶åˆå¹¶å¯¹åº” `CSSOM` ç»“ç‚¹ä¸­çš„æ ·å¼ä¿¡æ¯ã€‚è¿™é‡Œçš„â€œå¯è§â€æ˜¯æŒ‡ï¼Œå¦‚æœåœ¨åˆå¹¶è¿‡ç¨‹ä¸­ï¼ŒæŸä¸ª `DOM` ç»“ç‚¹å¯¹åº”çš„ `CSSOM` ç»“ç‚¹è¢«è®¾ç½®äº† `display: none` ä¹‹ç±»çš„å±æ€§ï¼Œä¾¿ä¼šè·³è¿‡è¯¥ç»“ç‚¹çš„åˆå¹¶ï¼›ä½† `opacity: 0`, `visible: hidden` è¿™ç§ä»ç„¶ä¼šå æ®ç©ºé—´ï¼Œå› æ­¤ä¾æ—§ä¼šè¢«åˆå¹¶ã€‚(PSï¼šè¿™é‡Œå°±ä¼šç‰µæ¶‰åˆ°æ€§èƒ½é—®é¢˜)

## Layout

æ ¹æ®æ ·å¼ä¿¡æ¯è®¡ç®—å„ä¸ªç»“ç‚¹åœ¨è®¾å¤‡è§†åŒºçš„ç¡®åˆ‡ä½ç½®ä»¥åŠå¤§å°ï¼Œå³ `å¸ƒå±€`.

## Paint

å°†å„ä¸ªç»“ç‚¹æ¸²æŸ“åˆ°å±å¹•çš„è¿‡ç¨‹ã€‚

![](/img/dom-render/render-progress.jpg)

------

æˆ‘ä»¬å¸¸è¯´çš„ï¼šå°½é‡é¿å…å»æ“ä½œ `DOM`ï¼Œå› ä¸ºæˆæœ¬å¾ˆé«˜ã€‚è¿™é‡Œçš„æˆæœ¬å³æŒ‡æ—¶é—´è€—è´¹ï¼Œä¹ŸæŒ‡èµ„æºè€—è´¹ã€‚å¦‚æœä½¿ç”¨ `JS` å»æ“ä½œ `DOM` å’Œ `CSS` æ—¶ï¼Œ`DOM Tree` å’Œ `CSSOM Tree` çš„å†…å®¹å°±ä¼šå‘ç”Ÿå˜æ›´ï¼Œä»è€Œå¯¼è‡´æ•´ä¸ªæ¸²æŸ“è¿‡ç¨‹é‡å¤æ‰§è¡Œï¼Œè€Œå…¶ä¸­å½±å“æœ€å¤§çš„å°±æ˜¯é‡æ–°æ‰§è¡Œ `Layout` è¿‡ç¨‹æ—¶è§¦å‘çš„ `reflow(å›æµ)` ä»¥åŠé‡æ–°æ‰§è¡Œ `Paint` æ—¶è§¦å‘çš„ `repaint(é‡ç»˜)`.

## reflow

å½“å‘ç”Ÿä»¥ä¸‹æƒ…å½¢æ—¶ä¼šè§¦å‘ `reflow` å›æµï¼š

- åˆå§‹æ¸²æŸ“æ—¶
- `DOM Tree` ç»“æ„å‘ç”Ÿå˜åŒ–æ—¶
- `Render Tree` ç»“æ„å‘ç”Ÿå˜åŒ–æ—¶
- æµè§ˆå™¨ `resize` æ—¶

ä»ä¸Šé¢çš„è¿‡ç¨‹æ¥çœ‹ï¼Œ`Layout` åœ¨ `Paint` ä¹‹å‰ï¼Œå› æ­¤æ¯æ¬¡è§¦å‘ `reflow` éƒ½ä¼šå¯¼è‡´æ•´ä¸ªé¡µé¢çš„é‡æ–°æ¸²æŸ“ã€‚

## repaint

å½“å‘ç”Ÿä»¥ä¸‹æƒ…å½¢æ—¶ä¼šè§¦å‘ `repaint` é‡ç»˜ï¼š

- è§¦å‘ `reflow` æ—¶
- ç»“ç‚¹çš„ `background-color`, `color`ç­‰ä¸å½±å“å…¶å‘¨å›´å’Œå†…éƒ¨å¸ƒå±€çš„å±æ€§æ”¹å˜æ—¶

åº”æ³¨æ„ `repaint` å¯ä»¥å•ç‹¬è§¦å‘ï¼Œä¸”åªä¼šå½±å“åˆ°å±æ€§æ”¹å˜çš„ç»“ç‚¹ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–ç»“ç‚¹ã€‚

{% note info %}

ä»ä¸Šé¢çš„æè¿°å¾ˆå®¹æ˜“å‘ç°ï¼Œ `reflow` çš„æˆæœ¬è¿œé«˜äº `repaint`ï¼Œä»æ€§èƒ½ä¼˜åŒ–ä¸Šçœ‹ï¼Œåº”è¯¥å°½é‡å‡å°‘ `reflow` æ¬¡æ•°ï¼Œä¾‹å¦‚

- å…ˆå°†éœ€è¦å¤šæ¬¡ä¿®æ”¹çš„ `DOM` è®¾ç½®ä¸º `display: none`ï¼Œå¾…æ“ä½œå®Œæ¯•åå†æ˜¾ç¤ºã€‚(ä¿®æ”¹ä¸åœ¨ `Render Tree` ä¸Šçš„ç»“ç‚¹å¹¶ä¸ä¼šè§¦å‘ `reflow` å’Œ `repaint` )
- ä½¿ç»“ç‚¹è„±ç¦»æ–‡æ¡£æµ

{% endnote %}

------

## å®ä¾‹

ğŸ‘‰[`display: none, visible: hidden, opacity: 0çš„ä¼˜åŠ£ã€åŒºåˆ«`](https://muyiy.cn/question/css/57.html)

<p class="note note-primary">å‚è€ƒï¼š <a href="https://juejin.im/entry/59e1d31f51882578c3411c77">https://juejin.im/entry/59e1d31f51882578c3411c77</a> </p>



